<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sunwin Mini Tool</title>

<style>
html,body{margin:0;width:100%;height:100%;overflow:hidden;font-family:Arial}

/* SUNWIN */
#sunwin{
    position:fixed;
    inset:0;
    border:none;
    z-index:1;
}

/* TOOL */
#tool{
    position:fixed;
    top:90px;
    left:15px;
    width:160px;
    background:rgba(0,0,0,.72);
    border-radius:12px;
    padding:8px;
    color:#fff;
    z-index:9999;
    user-select:none;
}

#tool img{
    width:46px;
    display:block;
    margin:0 auto 4px;
    filter:drop-shadow(0 0 6px gold);
}

#phien{
    text-align:center;
    font-size:11px;
    margin-bottom:4px;
}

.row{
    display:flex;
    justify-content:space-between;
}

.box{
    width:62px;
    height:62px;
    border-radius:50%;
    background:#fff;
    color:#000;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    font-size:11px;
}

.blink{
    animation:blink .8s infinite;
}
@keyframes blink{
    0%{box-shadow:0 0 4px gold}
    50%{box-shadow:0 0 14px gold}
    100%{box-shadow:0 0 4px gold}
}
</style>
</head>

<body>

<iframe id="sunwin" src="https://web.sunwin.sx/"></iframe>

<div id="tool">
    <img src="sunwin.png">
    <div id="phien">#----</div>
    <div class="row">
        <div id="tai" class="box">
            <b>TÀI</b>
            <span id="taiP">--%</span>
        </div>
        <div id="xiu" class="box">
            <b>XỈU</b>
            <span id="xiuP">--%</span>
        </div>
    </div>
</div>

<script>
const API="https://sunwinsaygex-pcl2.onrender.com/api/sun";

/* CHUẨN HÓA KẾT QUẢ */
function getTX(item){
    if(item.total!==undefined) return item.total>=11?"T":"X";
    if(item.result!==undefined){
        if(typeof item.result==="number")
            return item.result>=11?"T":"X";
        return item.result.includes("T")?"T":"X";
    }
    return "X";
}

/* AI NHIỀU THUẬT TOÁN */
function ai(data){
    let v=[];
    let d=data.map(getTX);

    // 1. 10 phiên
    let t=d.slice(0,10).filter(x=>x==="T").length;
    v.push(t>=5?"T":"X");

    // 2. bệt
    v.push(d[0]);

    // 3. đảo
    v.push(d[0]==="T"?"X":"T");

    // 4. 5 phiên
    t=d.slice(0,5).filter(x=>x==="T").length;
    v.push(t>=3?"T":"X");

    // 5. trọng số mới
    v.push(d[0]);

    return v;
}

async function run(){
    const r=await fetch(API);
    const data=await r.json();

    phien.innerText="#"+(data[0].phien||data[0].round||"---");

    const v=ai(data);
    const t=v.filter(x=>x==="T").length;
    const x=v.length-t;

    const tp=Math.round(t/v.length*100);
    const xp=100-tp;

    taiP.innerText=tp+"%";
    xiuP.innerText=xp+"%";

    tai.classList.remove("blink");
    xiu.classList.remove("blink");

    (tp>xp?tai:xiu).classList.add("blink");
}
run();
setInterval(run,5000);

/* DRAG */
let d=false,ox,oy;
tool.onmousedown=e=>{d=true;ox=e.clientX-tool.offsetLeft;oy=e.clientY-tool.offsetTop}
document.onmousemove=e=>{if(d){tool.style.left=e.clientX-ox+"px";tool.style.top=e.clientY-oy+"px"}}
document.onmouseup=()=>d=false;

tool.ontouchstart=e=>{d=true;ox=e.touches[0].clientX-tool.offsetLeft;oy=e.touches[0].clientY-tool.offsetTop}
document.ontouchmove=e=>{if(d){tool.style.left=e.touches[0].clientX-ox+"px";tool.style.top=e.touches[0].clientY-oy+"px"}}
document.ontouchend=()=>d=false;
</script>

</body>
</html>
