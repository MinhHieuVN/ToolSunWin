<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sunwin Floating Tool</title>

<style>
html,body{
    margin:0;
    width:100%;
    height:100%;
    overflow:hidden;
    font-family:Arial,sans-serif;
}

/* iframe Sunwin */
#sunwin {
    position:fixed;
    top:0;left:0;
    width:100%;
    height:100%;
    border:none;
    z-index:1;
}

/* TOOL FLOAT */
#tool {
    position:fixed;
    top:80px;
    left:20px;
    width:200px;
    background:rgba(0,0,0,0.75);
    border-radius:14px;
    color:#fff;
    padding:10px;
    z-index:9999;
    user-select:none;
}

/* LOGO */
#tool img {
    width:60px;
    display:block;
    margin:0 auto 6px;
    filter: drop-shadow(0 0 6px gold);
}

/* CENTER */
#phien {
    text-align:center;
    font-size:13px;
    margin-bottom:6px;
}

/* ROW */
.row {
    display:flex;
    justify-content:space-between;
}

/* BOX */
.box {
    width:80px;
    height:80px;
    border-radius:50%;
    background:#fff;
    color:#000;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    font-size:13px;
}

.blink {
    animation: blink 0.8s infinite;
}

@keyframes blink {
    0%{box-shadow:0 0 5px gold}
    50%{box-shadow:0 0 20px gold}
    100%{box-shadow:0 0 5px gold}
}
</style>
</head>

<body>

<iframe id="sunwin" src="https://web.sunwin.sx/"></iframe>

<div id="tool">
    <img src="sunwin.png" alt="SUNWIN">
    <div id="phien">#----</div>
    <div class="row">
        <div id="tai" class="box">
            <b>TÀI</b>
            <span id="taiP">0%</span>
        </div>
        <div id="xiu" class="box">
            <b>XỈU</b>
            <span id="xiuP">0%</span>
        </div>
    </div>
</div>

<script>
const API = "https://sunwinsaygex-pcl2.onrender.com/api/sun";

/* AI nhiều thuật toán */
function aiVotes(data){
    let v=[];

    // 1. 10 phiên
    let t=0,x=0;
    data.slice(0,10).forEach(i=>i.result.includes("T")?t++:x++);
    v.push(t>x?"T":"X");

    // 2. Bệt
    v.push(data[0].result.includes("T")?"T":"X");

    // 3. Đảo
    v.push(data[0].result.includes("T")?"X":"T");

    // 4. 5 phiên
    t=0;x=0;
    data.slice(0,5).forEach(i=>i.result.includes("T")?t++:x++);
    v.push(t>x?"T":"X");

    // 5. Trọng số mới
    v.push(data[0].result.includes("T")?"T":"X");

    return v;
}

async function run(){
    const r=await fetch(API);
    const d=await r.json();

    document.getElementById("phien").innerText =
        "#"+(d[0].phien||d[0].round);

    const v=aiVotes(d);
    const tai=v.filter(i=>i==="T").length;
    const xiu=v.length-tai;

    const tP=Math.round(t/v.length*100);
    const xP=100-tP;

    taiP.innerText=tP+"%";
    xiuP.innerText=xP+"%";

    tai.classList.remove("blink");
    xiu.classList.remove("blink");

    if(tP>xP) tai.classList.add("blink");
    else xiu.classList.add("blink");
}
run();
setInterval(run,5000);

/* DRAG */
let drag=false,ox,oy;
tool.addEventListener("mousedown",e=>{
    drag=true;
    ox=e.clientX-tool.offsetLeft;
    oy=e.clientY-tool.offsetTop;
});
document.addEventListener("mousemove",e=>{
    if(drag){
        tool.style.left=e.clientX-ox+"px";
        tool.style.top=e.clientY-oy+"px";
    }
});
document.addEventListener("mouseup",()=>drag=false);

/* Mobile */
tool.addEventListener("touchstart",e=>{
    drag=true;
    ox=e.touches[0].clientX-tool.offsetLeft;
    oy=e.touches[0].clientY-tool.offsetTop;
});
document.addEventListener("touchmove",e=>{
    if(drag){
        tool.style.left=e.touches[0].clientX-ox+"px";
        tool.style.top=e.touches[0].clientY-oy+"px";
    }
});
document.addEventListener("touchend",()=>drag=false);
</script>

</body>
</html>
